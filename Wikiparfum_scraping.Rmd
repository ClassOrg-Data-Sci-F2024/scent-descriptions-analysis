---
title: "Wikiparfum scraping"
output: html_notebook
---

```{r}
library(xml2)
library(plyr)
library(rvest)
library(tidyverse)
library(readr)
```

```{r}
parfum <- read_html("https://www.wikiparfum.com/en/fragrances/wood-sage-sea-salt-2024")
```

```{r}
parfum %>% 
  html_element(".flex-wrap") %>% 
  html_children() %>% 
  html_text()
```
```{r}
parfum2 <-  c("https://www.wikiparfum.com/en/fragrances/wood-sage-sea-salt-2024")
fragrence2 <- tibble(URL = parfum2) %>% 
   mutate(HTML = map(URL, read_html))


fragrence2 %>%   
mutate(ing =  
  html_element(".flex-wrap") %>% 
  html_children() %>% 
  html_text())
```


```{r}
fraglist <- read_xml("https://www.wikiparfum.com/fragrances_sitemap_en_0.xml")

fraglist %>% 
  xml_children()

library(xmlconvert)
#xml_to_df(fraglist)

```



```{r}
fragranceURLs <- c("https://www.wikiparfum.com/en/fragrances/wood-sage-sea-salt-2024")

fragrence <- tibble(URL = fragranceURLs) %>% 
  mutate(HTML = map(URL, read_html))
```

```{r}
fragrence <- fragrence %>% 
  # almost correct element
  mutate(frag.name = map(HTML, ~.x %>% 
                     html_element(".xl\\:col-start-5") %>% 
                     html_children() %>% 
                            html_text() %>% 
                       as.vector)) %>% 
                           #somehow need to remove brand from name
  # correct element
  mutate(ingredients = map(HTML, ~ .x %>% 
                              html_element(".flex-wrap") %>% 
                              html_children() %>% 
                              html_text())) %>% 
# correct element, need to remove "info"
mutate(price = map(HTML, ~.x %>% 
                     html_element(".text-16.flex.gap-2") %>% 
                            html_text())) %>%
  
 # almost correct element. needs some tidying
mutate(olfactive.class = map(HTML, ~.x %>% 
                     html_element(".p-3") %>% 
                     html_children() %>% 
                            html_text())) %>% 
# incorrect 
mutate(world.clasif = map(HTML, ~.x %>% 
                     html_element(".text-16") %>%
                       html_children() %>%
                            html_text())) %>% 
#Correct path!
  mutate(description = map(HTML, ~.x %>% 
                     html_element(".pb-3") %>% 
                            html_text())) %>% 
 #correct path
   mutate(origin = map(HTML, ~.x %>% 
                     html_element(".py-5") %>% 
                            html_text())) %>% 
  # correct path 
  mutate(gender = map(HTML, ~.x %>% 
                     html_element(".border-gold200:nth-child(2)") %>% 
                            html_text())) %>% 
  # correct path
    mutate(year = map(HTML, ~.x %>% 
                     html_element(".border-gold200:nth-child(3)") %>% 
                            html_text())) %>%
  
  # correct path
    mutate(concepts = map(HTML, ~.x %>% 
                     html_element(".border-gold200~ .border-gold200+ .border-gold200") %>% 
                            html_text())) %>% 
  # incorrect path
  mutate(perfumer = map(HTML, ~.x %>% 
                     html_element(".pt-5.gap-4") %>% 
                            html_text()))  


```

```{r}
print(fragrence)
```

```{r}
fragrence %>% 
  mutate(parfum %>% 
  html_element(".flex-wrap") %>% 
  html_children() %>% 
  html_text())
```



# Session info

```{r}
sessionInfo()
